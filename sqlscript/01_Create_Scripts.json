{
	"name": "01_Create_Scripts",
	"properties": {
		"folder": {
			"name": "Creation Scripts"
		},
		"content": {
			"query": "-- Check if the database 'nyc_taxi_ldw' does not exist\n\nIF NOT EXISTS(SELECT * FROM sys.databases WHERE name = 'nyc_taxi_ldw')\n    BEGIN\n        CREATE DATABASE nyc_taxi_ldw\n    END\n\nGO\n\n-- Check if the 'nyc_taxi_ldw' database and then alter the schema to add right collation to the database utf-8.\nIF NOT EXISTS(SELECT * FROM sys.databases WHERE name = 'nyc_taxi_ldw')\nBEGIN\n    Alter DATABASE nyc_taxi_ldw COLLATE Latin1_General_100_CI_AI_SC_UTF8\nEND\nGo\n\n-- Check if the 'bronze' schema exists\nIF NOT EXISTS (SELECT name FROM sys.schemas WHERE name = 'bronze')\nBEGIN\nEXEC ('CREATE SCHEMA bronze')\nEND\nGO\n\n-- Check if the 'silver' schema exists\nIF NOT EXISTS (SELECT name FROM sys.schemas WHERE name = 'silver')\nBEGIN\n    EXEC ('CREATE SCHEMA silver')\nEND\nGO\n\n-- Check if the 'gold' schema exists\nIF NOT EXISTS (SELECT name FROM sys.schemas WHERE name = 'gold')\nBEGIN\n    EXEC ('CREATE SCHEMA gold')\nEND\nGO\n\n-- Create external data source in nyc_taxi_ldw\nUSE nyc_taxi_ldw\nGO\n\n-- Create the external data source pointing to ADLS\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'nyc_data_raw')\nCREATE EXTERNAL DATA SOURCE nyc_data_raw\nWITH\n(\n    Location = 'https://devsynapseaccount01.dfs.core.windows.net/nyc-taxi-dataset'\n)\nGO\n\n-- Create the external file format pointing to ADLS\n\nIF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'csv_file_formats')\nCREATE EXTERNAL FILE FORMAT csv_file_formats\nWITH\n(\n    FORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS(\n        FIELD_TERMINATOR = ','\n        ,STRING_DELIMITER = '\"'\n        ,FIRST_ROW = 2\n        ,USE_TYPE_DEFAULT = FALSE\n        ,ENCODING = 'UTF8'\n        ,PARSER_VERSION = '2.0'\n    )\n)\nGO\n\nCREATE EXTERNAL TABLE bronze.taxi_zone\n(\n    location_id SMALLINT,\n    brough VARCHAR(15),\n    zone VARCHAR(50),\n    service_zone VARCHAR(15)\n\n)\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "nyc_taxi_ldw",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}